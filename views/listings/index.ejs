<% layout('layouts/boilerplate') %>

<!-- SEARCH AND FILTERS SECTION -->
<div class="hero-stays">
  <div class="overlay">
    <div class="container">
      <h1>Explore Amazing Stays</h1>
      <p>From treehouses to houseboats—discover unforgettable stays worldwide.</p>
    </div>
  </div>
</div>

<!-- FILTERS CONTAINER -->
<div class="filters-container">
  <div class="container">
    <div class="filter-wrapper">
      <!-- LEFT ARROW -->
      <button id="left-arrow" class="arrow-btn d-none d-md-flex">
        <i class="fa-solid fa-chevron-left"></i>
      </button>

      <!-- FILTERS SCROLL -->
      <div id="filters" class="filters-scroll">
        <a href="/listings/category/trending" class="filter">
          <div class="filter-icon">
            <i class="fa-solid fa-fire"></i>
          </div>
          <span class="filter-text">Trending</span>
        </a>
        
        <a href="/listings/category/rooms" class="filter">
          <div class="filter-icon">
            <i class="fa-solid fa-bed"></i>
          </div>
          <span class="filter-text">Rooms</span>
        </a>
        
        <a href="/listings/category/iconic-cities" class="filter">
          <div class="filter-icon">
            <i class="fa-solid fa-city"></i>
          </div>
          <span class="filter-text">Iconic Cities</span>
        </a>
        
        <a href="/listings/category/mountains" class="filter">
          <div class="filter-icon">
            <i class="fa-solid fa-mountain"></i>
          </div>
          <span class="filter-text">Mountains</span>
        </a>
        
        <a href="/listings/category/pools" class="filter">
          <div class="filter-icon">
            <i class="fa-solid fa-person-swimming"></i>
          </div>
          <span class="filter-text">Amazing Pools</span>
        </a>
        
        <a href="/listings/category/castles" class="filter">
          <div class="filter-icon">
            <i class="fa-brands fa-fort-awesome"></i>
          </div>
          <span class="filter-text">Castles</span>
        </a>
        
        <a href="/listings/category/camping" class="filter">
          <div class="filter-icon">
            <i class="fa-solid fa-tents"></i>
          </div>
          <span class="filter-text">Camping</span>
        </a>
        
        <a href="/listings/category/farms" class="filter">
          <div class="filter-icon">
            <i class="fa-solid fa-cow"></i>
          </div>
          <span class="filter-text">Farms</span>
        </a>
        
        <a href="/listings/category/snow" class="filter">
          <div class="filter-icon">
            <i class="fa-solid fa-snowman"></i>
          </div>
          <span class="filter-text">Snow Place</span>
        </a>
        
        <a href="/listings/category/historical" class="filter">
          <div class="filter-icon">
            <i class="fa-solid fa-monument"></i>
          </div>
          <span class="filter-text">Historical</span>
        </a>
        
        <a href="/listings/category/beach" class="filter">
          <div class="filter-icon">
            <i class="fa-solid fa-umbrella-beach"></i>
          </div>
          <span class="filter-text">Beach</span>
        </a>
        
        <a href="/listings/category/family" class="filter">
          <div class="filter-icon">
            <i class="fa-solid fa-people-group"></i>
          </div>
          <span class="filter-text">Family Trips</span>
        </a>
        
        <a href="/listings/category/adventure" class="filter">
          <div class="filter-icon">
            <i class="fa-solid fa-person-hiking"></i>
          </div>
          <span class="filter-text">Adventure</span>
        </a>
        
        <a href="/listings/category/environmental" class="filter">
          <div class="filter-icon">
            <i class="fa-solid fa-leaf"></i>
          </div>
          <span class="filter-text">Eco Stays</span>
        </a>
        
        <a href="/listings/category/island" class="filter">
          <div class="filter-icon">
            <i class="fa-solid fa-water"></i>
          </div>
          <span class="filter-text">Island Stays</span>
        </a>
        
        <a href="/listings/category/desert" class="filter">
          <div class="filter-icon">
            <i class="fa-solid fa-mountain-sun"></i>
          </div>
          <span class="filter-text">Desert</span>
        </a>
        
        <a href="/listings/category/jungle-safari" class="filter">
          <div class="filter-icon">
            <i class="fa-solid fa-binoculars"></i>
          </div>
          <span class="filter-text">Jungle Safari</span>
        </a>
        
        <a href="/listings/category/treehouse" class="filter">
          <div class="filter-icon">
            <i class="fa-solid fa-tree"></i>
          </div>
          <span class="filter-text">Treehouse</span>
        </a>
      </div>

      <!-- RIGHT ARROW -->
      <button id="right-arrow" class="arrow-btn d-none d-md-flex">
        <i class="fa-solid fa-chevron-right"></i>
      </button>

      <!-- RIGHT CONTROLS -->
      <div class="right-controls">
        <!-- TAX TOGGLE -->
        <div class="control-box tax-box" data-bs-toggle="tooltip" title="Toggle to show prices with GST">
          <div class="control-label">
            <i class="fa-solid fa-receipt me-2"></i>
            <span>Display After Adding Tax</span>
          </div>
          <label class="switch">
            <input type="checkbox" id="taxSwitch">
            <span class="slider round"></span>
          </label>
        </div>

        <!-- SORT DROPDOWN -->
        <div class="control-box sort-box">
          <div class="control-label">
            <i class="fa-solid fa-arrow-down-wide-short me-2"></i>
            <span>Sort By:</span>
          </div>
          <select id="sortSelect" class="form-select">
            <option value="recommended">Recommended</option>
            <option value="lowToHigh">Price: Low to High</option>
            <option value="highToLow">Price: High to Low</option>
            <option value="newest">Newest Listings</option>
            <option value="rating">Top Rated</option>
          </select>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- LISTINGS GRID -->
<div class="listings-grid-section">
  <div class="container">
    <!-- Results Count -->
    <div class="results-count mb-4">
      <h5> Available Properties</h5>
      
    </div>

    <!-- LISTINGS -->
   <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
      <% for (let listing of allListings) { %>
        <div class="col">
          <div class="card listing-card shadow-sm border-0 h-100">
            
            <!-- Image with Wishlist Button -->
            <div class="card-img-wrapper">
              <a href="/listings/<%= listing._id %>" class="card-image-link">
                <img src="<%= listing.image.url %>" 
                     class="card-img-top listing-img" 
                     alt="<%= listing.title %>"
                     loading="lazy">
              </a>
              
              <!-- Wishlist Button -->
              <button class="wishlist-btn" data-id="<%= listing._id %>">
                <% if (currUser && currUser.wishlist.includes(listing._id)) { %>
                  <i class="fa-solid fa-heart liked"></i>
                <% } else { %>
                  <i class="fa-regular fa-heart"></i>
                <% } %>
              </button>
            </div>

            <div class="card-body">
              <!-- Title and Location -->
              <h5 class="card-title listing-title">
                <a href="/listings/<%= listing._id %>" class="text-decoration-none text-dark">
                  <%= listing.title %>
                </a>
              </h5>
              
              <% if (listing.location) { %>
                <p class="listing-location text-muted mb-2">
                  <i class="fa-solid fa-location-dot me-1"></i>
                  <%= listing.location %>
                </p>
              <% } %>

              <!-- Rating -->
              <% if (listing.averageRating) { %>
                <div class="listing-rating mb-2">
                  <div class="stars">
                    <% for (let i = 1; i <= 5; i++) { %>
                      <% if (i <= Math.floor(listing.averageRating)) { %>
                        <i class="fa-solid fa-star"></i>
                      <% } else if (i - listing.averageRating < 1) { %>
                        <i class="fa-solid fa-star-half-stroke"></i>
                      <% } else { %>
                        <i class="fa-regular fa-star"></i>
                      <% } %>
                    <% } %>
                  </div>
                  <span class="rating-value ms-2">
                    <%= Number(listing.averageRating || 0).toFixed(1) %>
                    <% if (listing.reviews && listing.reviews.length > 0) { %>
                      (<%= listing.reviews.length %> reviews)
                    <% } %>
                  </span>
                </div>
              <% } else { %>
                <p class="no-rating text-muted mb-2">
                  <i class="fa-regular fa-star"></i> No reviews yet
                </p>
              <% } %>

              <!-- Category Tags -->
              <% if (listing.category) { %>
                <div class="listing-category mb-3">
                  <span class="badge bg-light text-dark border">
                    <i class="fa-solid fa-tag me-1"></i>
                    <%= listing.category %>
                  </span>
                </div>
              <% } %>

              <!-- Price -->
              <div class="listing-price">
                <div class="price-main">
                  <span class="price-amount">₹<%= listing.price.toLocaleString("en-IN") %></span>
                  <span class="price-unit">/ night</span>
                </div>
                <div class="price-tax">
                  <span class="gst-text">+18% GST</span>
                </div>
              </div>
            </div>

            <!-- Quick Actions -->
            <div class="card-footer bg-white border-0 pt-0">
              <a href="/bookings/new/<%= listing._id %>" class="btn btn-outline-primary w-100">
                <i class="fa-solid fa-calendar-check me-2"></i>
                Book Now
              </a>
            </div>
          </div>
        </div>
      <% } %>
    </div>

    <!-- No Results -->
    <% if (allListings.length === 0) { %>
      <div class="no-results text-center py-5">
        <i class="fa-solid fa-magnifying-glass fa-3x text-muted mb-3"></i>
        <h4>No listings found</h4>
        <p class="text-muted">Try adjusting your search or filter criteria</p>
        <a href="/listings" class="btn btn-primary">
          <i class="fa-solid fa-compass me-2"></i>
          Browse All Listings
        </a>
      </div>
    <% } %>

    <!-- Pagination (if you have pagination) -->
    <% if (totalPages > 1) { %>
      <nav class="mt-5">
        <ul class="pagination justify-content-center">
          <% if (currentPage > 1) { %>
            <li class="page-item">
              <a class="page-link" href="?page=<%= currentPage - 1 %>">
                <i class="fa-solid fa-chevron-left"></i>
              </a>
            </li>
          <% } %>
          
          <% for (let i = 1; i <= totalPages; i++) { %>
            <li class="page-item <%= currentPage === i ? 'active' : '' %>">
              <a class="page-link" href="?page=<%= i %>"><%= i %></a>
            </li>
          <% } %>
          
          <% if (currentPage < totalPages) { %>
            <li class="page-item">
              <a class="page-link" href="?page=<%= currentPage + 1 %>">
                <i class="fa-solid fa-chevron-right"></i>
              </a>
            </li>
          <% } %>
        </ul>
      </nav>
    <% } %>
  </div>
</div>

<style>
/* Design 2 — Bold & Visual */
.hero-stays {
  position: relative;
  height: 500px;
  background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.7)), 
              url('https://images.unsplash.com/photo-1566073771259-6a8506099945?ixlib=rb-1.2.1&auto=format&fit=crop&w=1920&q=80');
  background-size: cover;
  background-position: center;
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;
}

.hero-stays .overlay {
  width: 100%;
  padding: 2rem;
}

.hero-stays .container {
  max-width: 900px;
  margin: 0 auto;
}

.hero-stays h1 {
  font-size: 3.5rem;
  font-weight: 800;
  color: white;
  margin-bottom: 1.5rem;
  text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.3);
}

.hero-stays p {
  font-size: 1.5rem;
  color: rgba(255, 255, 255, 0.9);
  margin-bottom: 3rem;
  max-width: 700px;
  margin-left: auto;
  margin-right: auto;
  line-height: 1.5;
}



/* Responsive Design 2 */
@media (max-width: 768px) {
  .hero-stays {
    height: 450px;
  }
  
  .hero-stays h1 {
    font-size: 2.5rem;
  }
  
  .hero-stays p {
    font-size: 1.25rem;
    padding: 0 1rem;
  }
  
}

/* Enhanced Search */
.search-form-enhanced .input-group {
  max-width: 700px;
  margin: 0 auto;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
  border-radius: 50px;
  overflow: hidden;
}

.search-form-enhanced .input-group-text {
  background: white;
  border: none;
  padding: 0 20px;
  color: #667eea;
  font-size: 1.1rem;
}

.search-form-enhanced .form-control {
  border: none;
  padding: 15px;
  font-size: 1rem;
}

.search-form-enhanced .form-control:focus {
  box-shadow: none;
}

.search-form-enhanced .btn {
  padding: 15px 30px;
  border-radius: 0 50px 50px 0;
  font-weight: 600;
  background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
  border: none;
}

/* Filters Container */
.filters-container {
  background: white;
  padding: 20px 0;
  border-bottom: 1px solid #eee;
  position: sticky;
  top: 0;
  z-index: 10;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
}

.filter-wrapper {
  display: flex;
  align-items: center;
  gap: 15px;
  position: relative;
}

/* Filters Scroll */
.filters-scroll {
  display: flex;
  overflow-x: auto;
  gap: 25px;
  scrollbar-width: thin;
  scrollbar-color: #ddd transparent;
  padding: 10px 0;
  flex: 1;
}

.filters-scroll::-webkit-scrollbar {
  height: 4px;
}

.filters-scroll::-webkit-scrollbar-track {
  background: transparent;
}

.filters-scroll::-webkit-scrollbar-thumb {
  background: #ddd;
  border-radius: 10px;
}

/* Filter Items */
.filter {
  display: flex;
  flex-direction: column;
  align-items: center;
  text-decoration: none;
  color: #666;
  transition: all 0.3s ease;
  min-width: 70px;
}

.filter:hover {
  color: #667eea;
  transform: translateY(-3px);
}

.filter.active {
  color: #667eea;
}

.filter-icon {
  width: 56px;
  height: 56px;
  border-radius: 50%;
  background: #f8f9fa;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-bottom: 8px;
  transition: all 0.3s ease;
  border: 2px solid transparent;
}

.filter:hover .filter-icon {
  background: rgba(102, 126, 234, 0.1);
  border-color: rgba(102, 126, 234, 0.2);
}

.filter.active .filter-icon {
  background: rgba(102, 126, 234, 0.1);
  border-color: #667eea;
}

.filter-icon i {
  font-size: 20px;
}

.filter-text {
  font-size: 12px;
  font-weight: 500;
  white-space: nowrap;
}

/* Arrow Buttons */
.arrow-btn {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: white;
  border: 1px solid #ddd;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #666;
  transition: all 0.3s ease;
  flex-shrink: 0;
}

.arrow-btn:hover {
  background: #667eea;
  color: white;
  border-color: #667eea;
  box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
}

/* Right Controls */
.right-controls {
  display: flex;
  gap: 20px;
  margin-left: auto;
  flex-shrink: 0;
}

.control-box {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px 18px;
  background: white;
  border: 1px solid #ddd;
  border-radius: 12px;
  transition: all 0.3s ease;
}

.control-box:hover {
  border-color: #667eea;
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
  transform: translateY(-2px);
}

.control-label {
  display: flex;
  align-items: center;
  color: #555;
  font-weight: 500;
  font-size: 14px;
}

/* Switch Toggle */
.switch {
  position: relative;
  display: inline-block;
  width: 50px;
  height: 26px;
}

.switch input {
  opacity: 0;
  width: 0;
  height: 0;
}

.slider {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: #ccc;
  transition: .4s;
  border-radius: 34px;
}

.slider:before {
  position: absolute;
  content: "";
  height: 18px;
  width: 18px;
  left: 4px;
  bottom: 4px;
  background-color: white;
  transition: .4s;
  border-radius: 50%;
}

input:checked + .slider {
  background: linear-gradient(135deg, #667eea, #764ba2);
}

input:checked + .slider:before {
  transform: translateX(24px);
}

/* Sort Select */
.sort-box .form-select {
  border: none;
  background: transparent;
  padding: 0;
  font-weight: 500;
  color: #667eea;
  cursor: pointer;
  min-width: 140px;
}

.sort-box .form-select:focus {
  box-shadow: none;
}

/* Listings Grid */
.listings-grid-section {
  padding: 30px 0 60px;
}

.results-count h5 {
  font-weight: 600;
  color: #333;
}

/* Listing Card */
.listing-card {
  transition: all 0.3s ease;
  border-radius: 16px;
  overflow: hidden;
}

.listing-card:hover {
  transform: translateY(-8px);
  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1) !important;
}

.card-img-wrapper {
  position: relative;
  overflow: hidden;
}

.listing-img {
  height: 220px;
  width: 100%;
  object-fit: cover;
  transition: transform 0.5s ease;
}

.listing-card:hover .listing-img {
  transform: scale(1.05);
}

/* Wishlist Button */
.wishlist-btn {
  position: absolute;
  top: 15px;
  right: 15px;
  width: 36px;
  height: 36px;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.9);
  border: none;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #666;
  cursor: pointer;
  transition: all 0.3s ease;
  z-index: 2;
}

.wishlist-btn:hover {
  background: white;
  color: #ff385c;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
}

.wishlist-btn .liked {
  color: #ff385c;
}

/* Listing Content */
.listing-title {
  font-size: 1.1rem;
  font-weight: 600;
  margin-bottom: 5px;
}

.listing-title a:hover {
  color: #667eea !important;
}

.listing-location {
  font-size: 0.9rem;
}

.listing-rating {
  display: flex;
  align-items: center;
}

.stars {
  color: #ffb400;
  font-size: 0.9rem;
}

.rating-value {
  font-size: 0.9rem;
  color: #666;
  font-weight: 500;
}

.no-rating {
  font-size: 0.9rem;
}

/* Price Section */
.listing-price {
  margin-top: 15px;
  padding-top: 15px;
  border-top: 1px solid #eee;
}

.price-main {
  display: flex;
  align-items: baseline;
  gap: 4px;
}

.price-amount {
  font-size: 1.4rem;
  font-weight: 700;
  color: #333;
}

.price-unit {
  color: #666;
  font-size: 0.9rem;
}

.price-tax {
  font-size: 0.8rem;
  color: #666;
}

.gst-text {
  color: #666;
  font-size: 0.8rem;
}

/* No Results */
.no-results {
  padding: 80px 20px;
}

.no-results i {
  opacity: 0.5;
}

/* Responsive Design */
@media (max-width: 768px) {
  .listings-header {
    padding: 30px 0 20px;
  }
  
  .listings-header h1 {
    font-size: 2rem;
  }
  
  .search-form-enhanced .btn {
    padding: 12px 20px;
  }
  
  .right-controls {
    flex-direction: column;
    gap: 10px;
    width: 100%;
    margin-top: 15px;
  }
  
  .control-box {
    width: 100%;
    justify-content: space-between;
  }
  
  .filters-scroll {
    gap: 15px;
  }
  
  .filter {
    min-width: 60px;
  }
  
  .filter-icon {
    width: 48px;
    height: 48px;
  }
  
  .listing-img {
    height: 180px;
  }
}

@media (max-width: 576px) {
  .filter-wrapper {
    flex-direction: column;
    align-items: stretch;
  }
  
  .filters-scroll {
    order: 1;
  }
  
  .right-controls {
    order: 2;
  }
  
  .arrow-btn {
    display: none !important;
  }
  
  .listing-card:hover {
    transform: translateY(-5px);
  }
}

/* Animations */
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}

.listing-card {
  animation: fadeIn 0.5s ease forwards;
  opacity: 0;
}

.listing-card:nth-child(1) { animation-delay: 0.1s; }
.listing-card:nth-child(2) { animation-delay: 0.2s; }
.listing-card:nth-child(3) { animation-delay: 0.3s; }
.listing-card:nth-child(4) { animation-delay: 0.4s; }
.listing-card:nth-child(5) { animation-delay: 0.5s; }
.listing-card:nth-child(6) { animation-delay: 0.6s; }
</style>

<script>
// DOM Elements
const filtersScroll = document.getElementById('filters');
const leftArrow = document.getElementById('left-arrow');
const rightArrow = document.getElementById('right-arrow');
const taxSwitch = document.getElementById('taxSwitch');
const gstTexts = document.querySelectorAll('.gst-text');
const sortSelect = document.getElementById('sortSelect');

// Filter Scroll Functionality
if (rightArrow) {
  rightArrow.addEventListener('click', () => {
    filtersScroll.scrollBy({ left: 300, behavior: 'smooth' });
    updateArrowVisibility();
  });
}

if (leftArrow) {
  leftArrow.addEventListener('click', () => {
    filtersScroll.scrollBy({ left: -300, behavior: 'smooth' });
    updateArrowVisibility();
  });
}

// Update arrow visibility based on scroll position
function updateArrowVisibility() {
  if (!leftArrow || !rightArrow) return;
  
  const scrollLeft = filtersScroll.scrollLeft;
  const scrollWidth = filtersScroll.scrollWidth;
  const clientWidth = filtersScroll.clientWidth;
  
  leftArrow.style.opacity = scrollLeft > 0 ? '1' : '0.5';
  rightArrow.style.opacity = (scrollLeft + clientWidth) < scrollWidth ? '1' : '0.5';
}

// Listen for scroll events
filtersScroll.addEventListener('scroll', updateArrowVisibility);

// Initialize arrow visibility
updateArrowVisibility();

// Active Filter Link
document.querySelectorAll('.filter').forEach(link => {
  link.addEventListener('click', function(e) {
    if (this.getAttribute('href') === '#') {
      e.preventDefault();
    }
    
    document.querySelectorAll('.filter').forEach(item => {
      item.classList.remove('active');
    });
    
    this.classList.add('active');
    
    // Update URL without page reload (for better UX)
    const url = this.getAttribute('href');
    if (url && url !== '#') {
      history.pushState(null, '', url);
      // You might want to add AJAX loading here
    }
  });
});

// GST Tax Toggle
taxSwitch.addEventListener('change', function() {
  const isChecked = this.checked;
  
  // Toggle GST text visibility
  gstTexts.forEach(el => {
    el.style.display = isChecked ? 'inline-block' : 'none';
  });
  
  // Add visual feedback
  const taxBox = this.closest('.tax-box');
  if (isChecked) {
    taxBox.classList.add('active');
    taxBox.style.background = 'rgba(102, 126, 234, 0.1)';
    taxBox.style.borderColor = '#667eea';
  } else {
    taxBox.classList.remove('active');
    taxBox.style.background = '';
    taxBox.style.borderColor = '';
  }
  
  // Show price update message
  showToast(isChecked ? 'Showing prices with GST' : 'Showing base prices');
});

// Sort Select Change
sortSelect.addEventListener('change', function() {
  const sortValue = this.value;
  let url = '/listings';
  
  switch(sortValue) {
    case 'lowToHigh':
      url = '/listings?sort=priceAsc';
      break;
    case 'highToLow':
      url = '/listings?sort=priceDesc';
      break;
    case 'newest':
      url = '/listings?sort=newest';
      break;
    case 'rating':
      url = '/listings?sort=rating';
      break;
    default:
      url = '/listings';
  }
  
  window.location.href = url;
});

// Wishlist Functionality
document.querySelectorAll('.wishlist-btn').forEach(btn => {
  btn.addEventListener('click', async function(e) {
    e.preventDefault();
    e.stopPropagation();
    
    const listingId = this.getAttribute('data-id');
    const icon = this.querySelector('i');
    
    try {
      const response = await fetch(`/listings/${listingId}/wishlist`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        }
      });
      
      if (response.ok) {
        // Toggle heart icon
        icon.classList.toggle('fa-regular');
        icon.classList.toggle('fa-solid');
        icon.classList.toggle('liked');
        
        // Show feedback
        if (icon.classList.contains('liked')) {
          showToast('Added to wishlist!', 'success');
        } else {
          showToast('Removed from wishlist', 'info');
        }
        
        // Add bounce animation
        this.style.transform = 'scale(1.3)';
        setTimeout(() => {
          this.style.transform = '';
        }, 300);
      } else {
        const error = await response.json();
        showToast(error.message || 'Login required', 'error');
      }
    } catch (error) {
      showToast('Something went wrong', 'error');
      console.error('Wishlist error:', error);
    }
  });
});

// Card click (excluding wishlist button)
document.querySelectorAll('.listing-card').forEach(card => {
  card.addEventListener('click', function(e) {
    // Don't trigger if clicking wishlist button or link
    if (e.target.closest('.wishlist-btn') || e.target.closest('a')) {
      return;
    }
    
    const link = this.querySelector('.listing-title a');
    if (link) {
      window.location.href = link.getAttribute('href');
    }
  });
});

// Toast Notification Function
function showToast(message, type = 'info') {
  // Remove existing toast
  const existingToast = document.querySelector('.custom-toast');
  if (existingToast) {
    existingToast.remove();
  }
  
  // Create toast
  const toast = document.createElement('div');
  toast.className = `custom-toast toast-${type}`;
  toast.innerHTML = `
    <div class="toast-content">
      <i class="fa-solid ${type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle'}"></i>
      <span>${message}</span>
    </div>
  `;
  
  document.body.appendChild(toast);
  
  // Show toast
  setTimeout(() => {
    toast.classList.add('show');
  }, 10);
  
  // Hide after 3 seconds
  setTimeout(() => {
    toast.classList.remove('show');
    setTimeout(() => {
      if (toast.parentNode) {
        toast.remove();
      }
    }, 300);
  }, 3000);
}

// Add toast styles
const toastStyles = document.createElement('style');
toastStyles.textContent = `
.custom-toast {
  position: fixed;
  bottom: 30px;
  left: 50%;
  transform: translateX(-50%) translateY(100px);
  background: white;
  color: #333;
  padding: 12px 24px;
  border-radius: 12px;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
  z-index: 9999;
  opacity: 0;
  transition: all 0.3s ease;
  min-width: 300px;
  max-width: 90%;
}

.custom-toast.show {
  transform: translateX(-50%) translateY(0);
  opacity: 1;
}

.custom-toast .toast-content {
  display: flex;
  align-items: center;
  gap: 10px;
  font-weight: 500;
}

.toast-success .toast-content i { color: #4CAF50; }
.toast-error .toast-content i { color: #f44336; }
.toast-info .toast-content i { color: #667eea; }
`;
document.head.appendChild(toastStyles);

// Initialize Bootstrap tooltips
document.addEventListener('DOMContentLoaded', function() {
  const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
  tooltipTriggerList.map(function (tooltipTriggerEl) {
    return new bootstrap.Tooltip(tooltipTriggerEl);
  });
});

// Handle window resize
window.addEventListener('resize', updateArrowVisibility);

// Initialize GST text visibility
gstTexts.forEach(el => {
  el.style.display = 'none';
});
</script>